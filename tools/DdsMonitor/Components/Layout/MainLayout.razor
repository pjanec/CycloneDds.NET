@using DdsMonitor.Components
@inherits LayoutComponentBase

@using System.IO

@inject IWindowManager WindowManager
@inject IWorkspaceState WorkspaceState

<div class="app-shell">
    <div class="app-toolbar">
        <button type="button" class="app-toolbar__button" @onclick="OpenTopicsPanel">Topics</button>
        <button type="button" class="app-toolbar__button" @onclick="ResetLayout">Reset Layout</button>
    </div>
    <div class="app-shell__content">
        @Body
    </div>
</div>

@code {
    private static readonly string TopicExplorerTypeName = typeof(TopicExplorerPanel).AssemblyQualifiedName!;

    private void OpenTopicsPanel()
    {
        foreach (var panel in WindowManager.ActivePanels)
        {
            if (string.Equals(panel.ComponentTypeName, TopicExplorerTypeName, StringComparison.Ordinal))
            {
                panel.IsMinimized = false;
                panel.IsHidden = false;
                WindowManager.BringToFront(panel.PanelId);
                return;
            }
        }

        var newPanel = WindowManager.SpawnPanel(TopicExplorerTypeName);
        newPanel.Title = "Topics";
    }

    private void ResetLayout()
    {
        var filePath = WorkspaceState.WorkspaceFilePath;
        if (!string.IsNullOrWhiteSpace(filePath) && File.Exists(filePath))
        {
            File.Delete(filePath);
        }

        WindowManager.ClearPanels();
        var newPanel = WindowManager.SpawnPanel(TopicExplorerTypeName);
        newPanel.Title = "Topics";

        if (!string.IsNullOrWhiteSpace(filePath))
        {
            WindowManager.SaveWorkspace(filePath);
        }
    }
}
